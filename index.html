<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Công Cụ Minh Họa Phí Bảo Hiểm AIA</title>
  <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
  <link href="style.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com" rel="preconnect"/>
  <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
  <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap" rel="stylesheet"/>

  <!-- IMAGE GALLERY MODULE CSS -->
  <style id="image-gallery-module-styles">
    .img-company-gallery{
      margin:24px 0 32px;
      padding:16px 12px 4px;
      border:1px solid #e5e7eb;
      border-radius:12px;
      background:#fff;
    }
    .img-company-gallery h3{
      margin:0 0 14px;
      font-size:18px;
      font-weight:600;
    }
    .img-company-grid{
      display:grid;
      gap:14px;
      grid-template-columns:repeat(auto-fill,minmax(180px,1fr));
    }
    .img-product-gallery{
      margin:40px 0 60px;
      padding:20px 16px 8px;
      border:1px solid #e5e7eb;
      border-radius:14px;
      background:#fff;
    }
    .img-product-gallery h3{
      margin:0 0 18px;
      font-size:20px;
      font-weight:700;
    }
    .img-product-block{ margin-bottom:36px; }
    .img-product-title{
      font-size:16px;
      font-weight:600;
      margin:0 0 8px;
      color:#333;
    }
    .img-grid{
      display:grid;
      gap:14px;
      grid-template-columns:repeat(auto-fill,minmax(190px,1fr));
    }
    .img-figure{
      margin:0;
      padding:10px;
      background:#fafafa;
      border:1px solid #ececec;
      border-radius:10px;
      display:flex;
      flex-direction:column;
      gap:8px;
      position:relative;
      cursor:zoom-in;
      transition:box-shadow .2s;
    }
    .img-figure:hover{ box-shadow:0 2px 6px rgba(0,0,0,.12); }
    .img-thumb{
      width:100%;
      background:#fff;
      border-radius:6px;
      object-fit:contain;
      max-height:250px;
      transition:transform .2s ease, opacity .2s;
    }
    .img-thumb.loading{ opacity:0.3; }
    .img-caption{
      font-size:12px;
      line-height:1.35;
      text-align:center;
      color:#444;
      min-height:28px;
      overflow-wrap:break-word;
    }
    .orientation-portrait .img-thumb{ max-height:320px; }
    .orientation-landscape .img-thumb{ max-height:210px; }
    .img-thumb-error{
      opacity:.5;
      filter:grayscale(1);
      outline:2px dashed #d33;
    }
    .img-lightbox{
      position:fixed;
      inset:0;
      z-index:9999;
      display:none;
      font-family:inherit;
    }
    .img-lightbox.show{ display:block; }
    .img-lightbox-backdrop{
      position:absolute;
      inset:0;
      background:rgba(0,0,0,0.75);
      backdrop-filter:blur(2px);
    }
    .img-lightbox-dialog{
      position:absolute;
      top:50%;left:50%;
      transform:translate(-50%,-50%);
      max-width:92vw;
      max-height:90vh;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:14px;
      color:#fff;
    }
    .img-lightbox-dialog img{
      max-width:92vw;
      max-height:70vh;
      object-fit:contain;
      background:#111;
      border-radius:10px;
      box-shadow:0 0 0 1px #444;
    }
    .img-lightbox-caption{
      font-size:14px;
      max-width:80ch;
      text-align:center;
      line-height:1.35;
    }
    .img-lightbox-close{
      position:absolute;
      top:-44px;
      right:-8px;
      background:transparent;
      color:#fff;
      font-size:42px;
      border:none;
      cursor:pointer;
      line-height:1;
    }
    .img-lightbox-nav{
      display:flex;
      gap:16px;
    }
    .img-lightbox-nav button{
      background:#fff;
      color:#000;
      border:none;
      padding:8px 16px;
      font-size:14px;
      font-weight:600;
      border-radius:24px;
      cursor:pointer;
    }
    .img-lightbox-nav button:disabled{
      opacity:.35;
      cursor:default;
    }
  </style>
</head>
<body class="bg-gray-50 font-sans text-gray-800">
  <div class="container mx-auto p-4 sm:p-6 lg:p-8">
    <header class="flex items-center justify-between pb-6 border-b-2 border-red-600 mb-6">
      <img src="https://www.aia.com.vn/content/dam/group-wise/images/system/icons/aia-logo-red.svg" alt="AIA Logo" class="h-8" />
      <h1 class="text-2xl sm:text-3xl font-bold text-gray-800 text-right">Công Cụ Minh Họa Phí Bảo Hiểm</h1>
    </header>

    <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <div class="lg:col-span-2 space-y-6">

        <!-- ĐÃ GỠ gallery công ty & product khỏi trang chính theo yêu cầu -->

        <div id="main-person-container" class="person-container space-y-6 bg-white p-6 rounded-lg shadow-sm border border-gray-200">
          <h2 class="text-xl font-bold text-aia-red mb-4">1. Thông Tin Người Được Bảo Hiểm Chính</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="font-medium block mb-1">Họ và Tên</label>
              <input type="text" class="form-input name-input" placeholder="Nguyễn Văn A">
            </div>
            <div>
              <label class="font-medium block mb-1">Ngày sinh</label>
              <input type="text" class="form-input dob-input" placeholder="DD/MM/YYYY">
            </div>
            <div>
              <label class="font-medium block mb-1">Giới tính</label>
              <select class="form-select gender-select">
                <option value="Nam">Nam</option>
                <option value="Nữ">Nữ</option>
              </select>
            </div>
            <div class="flex items-end">
              <p class="text-lg">Tuổi: <span class="font-bold text-aia-red age-span">0</span></p>
            </div>
            <div class="relative">
              <label class="font-medium block mb-1">Nghề nghiệp</label>
              <input type="text" class="form-input occupation-input" placeholder="Gõ để tìm nghề nghiệp...">
              <div class="occupation-autocomplete hidden absolute z-10 w-full bg-white border border-gray-300 rounded-md mt-1 max-h-60 overflow-y-auto"></div>
            </div>
            <div class="flex items-end">
              <p class="text-lg">Nhóm nghề: <span class="font-bold text-aia-red risk-group-span">...</span></p>
            </div>
          </div>
        </div>

        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
          <h2 class="text-xl font-bold text-aia-red mb-4">2. Lựa Chọn Sản Phẩm Chính</h2>
          <div>
            <select id="main-product" class="form-select">
              <option value="">-- Chọn sản phẩm chính --</option>
              <option value="PUL_TRON_DOI">Khoẻ trọn vẹn - Trọn đời</option>
              <option value="PUL_15NAM">Khoẻ trọn vẹn - 15 năm</option>
              <option value="PUL_5NAM">Khoẻ trọn vẹn - 5 năm</option>
              <option value="KHOE_BINH_AN">MUL - Khoẻ Bình An</option>
              <option value="VUNG_TUONG_LAI">MUL - Vững Tương Lai</option>
              <option value="TRON_TAM_AN">Trọn tâm an</option>
              <option value="AN_BINH_UU_VIET">An Bình Ưu Việt</option>
            </select>
          </div>
          <div id="main-product-options" class="mt-4 space-y-4"></div>
          <div id="main-product-fee-display" class="text-right font-bold text-lg text-aia-red mt-2 min-h-[1.75rem]"></div>
        </div>

          <div id="main-supp-container" class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
          <h2 class="text-xl font-bold text-aia-red mb-4">3. Lựa Chọn Sản Phẩm Bổ Sung (Cho NĐBH Chính)</h2>
          <div class="supplementary-products-container space-y-6"></div>
        </div>

        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
          <h2 class="text-xl font-bold text-aia-red mb-4">4. Người Được Bảo Hiểm Bổ Sung</h2>
          <div id="supplementary-insured-container" class="space-y-6"></div>
          <button id="add-supp-insured-btn" class="mt-4 px-4 py-2 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 transition-colors w-full text-left flex items-center space-x-2">
            <span>+ Thêm Người Được Bảo Hiểm Bổ Sung</span>
          </button>
        </div>

        <div id="mdp3-section" class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 hidden">
          <h2 class="text-xl font-bold text-aia-red mb-4">5. Miễn Đóng Phí 3.0 (Bên mua bảo hiểm)</h2>
          <div class="flex items-center space-x-2 mb-3">
            <input type="checkbox" id="mdp3-enable" class="form-checkbox">
            <label for="mdp3-enable" class="text-gray-700 font-medium">Miễn đóng phí 3.0</label>
          </div>
          <div id="mdp3-select-container"></div>
          <div id="mdp3-fee-display" class="mt-3 text-aia-red font-bold"></div>
        </div>
      </div>

      <div class="lg:col-span-1">
        <div id="results-container" class="bg-white p-5 rounded-xl shadow-sm border-2 border-aia-red sticky top-8 space-y-3">

          <div class="flex items-center justify-between">
            <h2 class="text-base font-semibold text-gray-700">Tổng phí (năm)</h2>
          </div>
          <div class="text-2xl font-extrabold text-aia-red tracking-tight">
            <span id="summary-total">0</span>
          </div>

          <div class="border-t pt-3">
            <ul class="text-base space-y-1">
              <li class="flex justify-between">
                <span>Phí sản phẩm chính</span><span id="main-insured-main-fee">0</span>
              </li>
              <li class="flex justify-between">
                <span>Phí đóng thêm</span><span id="main-insured-extra-fee">0</span>
              </li>
              <li class="flex justify-between">
                <span>Phí sản phẩm bổ sung</span><span id="summary-supp-fee">0</span>
              </li>
            </ul>
          </div>

          <div class="border-t pt-3">
            <div id="supp-insured-summary-line" class="flex justify-between text-base mt-1">
              <button id="toggle-supp-list-btn" class="text-base text-aia-red underline">Xem từng người</button>
            </div>
            <div id="supp-insured-summaries" class="mt-2 hidden text-base space-y-1"></div>
          </div>
        
          <div>
            <label for="payment-frequency" class="font-medium text-gray-700 block mb-1">Kỳ đóng phí</label>
            <select id="payment-frequency" class="form-select w-full" aria-label="Kỳ đóng phí">
              <option value="year" selected>Năm (mặc định)</option>
              <option value="half">Nửa năm</option>
              <option value="quarter">Quý</option>
            </select>
          </div>

          <div id="frequency-breakdown" class="space-y-1 text-gray-700 hidden text-base">
            <div class="flex justify-between">
              <span>Phí chính:</span><span id="freq-main">0</span>
            </div>
            <div class="flex justify-between">
              <span>Phí đóng thêm:</span><span id="freq-extra">0</span>
            </div>
            <div class="flex justify-between">
              <span>Phí sản phẩm bổ sung:</span><span id="freq-supp-total">0</span>
            </div>
            <div class="flex justify-between font-semibold">
              <span>Tổng:</span><span id="freq-total-period" class="text-aia-red">0</span>
            </div>
            <div class="flex justify-between">
              <span>Tổng quy năm:</span><span id="freq-total-year-equivalent">0</span>
            </div>
            <div class="flex justify-between">
              <span>Tổng năm:</span><span id="freq-total-year">0</span>
            </div>
            <div class="flex justify-between">
              <span>Chênh lệch:</span><span id="freq-diff" class="text-red-600 font-bold">0</span>
            </div>
          </div>

          <div class="border-t pt-3 space-y-2" id="target-age-block">
            <div>
              <label for="target-age-input" id="target-age-label" class="font-medium text-gray-700 block mb-1">
                Minh họa phí đến năm (tuổi NĐBH chính)
              </label>
              <input type="number" id="target-age-input" class="form-input" placeholder="VD: 75" min="0" max="100">
              <p id="target-age-hint" class="text-sm text-gray-500 mt-1"></p>
              <p id="target-age-error" class="text-sm text-red-600 mt-1 hidden"></p>
            </div>
            <div>
              <label for="custom-interest-rate-input" class="font-medium text-gray-700 block mb-1">
                Lãi suất minh họa (%)
              </label>
              <input type="number" id="custom-interest-rate-input" class="form-input" placeholder="VD: 4.7" value="4.7">
            </div>
            <div id="global-error-box" class="hidden" aria-live="assertive"></div>

            <button id="view-summary-btn" class="w-full bg-aia-red text-white font-bold py-3 px-4 rounded-lg hover:bg-red-700 transition-colors" aria-controls="summary-modal">Xem Bảng Minh Họa Chi Tiết</button>
            <button id="btnFullViewer" class="w-full bg-green-600 text-white font-bold py-3 px-4 rounded">Mở trang đầy đủ</button>
            <div id="error-message" class="text-center text-red-500 font-medium min-h-[1.25rem]" aria-live="assertive"></div>
          </div>
        </div>

        <div id="compat-shim" class="hidden">
          <span id="main-premium-result">0</span>
          <div id="supplementary-premiums-results"></div>
          <span id="total-premium-result">0</span>
        </div>
      </div>
    </main>

    <footer class="text-center text-gray-500 mt-12 py-4 border-t">
      Công cụ này chỉ mang tính chất tham khảo cá nhân, không phải là bảng minh họa chính thức của AIA. Quyền lợi và mức phí cụ thể sẽ được xác nhận trong hợp đồng do AIA phát hành. 
      Vui lòng liên hệ tư vấn viên AIA để được tư vấn chi tiết và nhận bảng minh họa chính thức
    </footer>
  </div>

  <div id="summary-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50" role="dialog" aria-modal="true" aria-labelledby="summary-modal-title">
    <div class="bg-white rounded-lg shadow-xl max-w-5xl w-full max-h-[90vh] flex flex-col">
      <div class="p-4 border-b flex justify-between items-center sticky top-0 bg-white">
        <h2 id="summary-modal-title" class="text-2xl font-bold text-aia-red">Bảng Tóm Tắt Quyền Lợi và Phí</h2>
        <button id="close-summary-modal-btn" class="text-3xl font-light leading-none hover:text-red-600" aria-label="Đóng bảng tóm tắt">&times;</button>
      </div>
      <div id="summary-content-container" class="p-6 overflow-y-auto">
        <!-- GỢI Ý (nếu bạn tự sinh HTML bằng logic.js, thêm id như sau để anchor ổn định):
             <h2 id="summary-section-1">Phần 1 - Tóm tắt sản phẩm</h2>
             ...
             <h2 id="summary-section-2">Phần 2 - Tóm tắt quyền lợi</h2>
             ...
             <h2 id="summary-section-3">Phần 3 - Bảng phí</h2>
             Module sẽ chèn:
             [Company Gallery] trước Section 1
             [Product Gallery] sau Section 3
             Nếu không có ID, fallback sẽ dò text ("Phần 1"/"Tóm tắt sản phẩm", "Phần 3"/"Bảng phí"). -->
      </div>
      <div class="p-6 border-t">
        <p class="font-bold text-gray-800">
          Công cụ này chỉ mang tính chất tham khảo cá nhân, không phải là bảng minh họa chính thức của AIA.
          Quyền lợi và mức phí cụ thể sẽ được xác nhận trong hợp đồng do AIA phát hành.
          Vui lòng liên hệ tư vấn viên AIA để được tư vấn chi tiết và nhận bảng minh họa chính thức.
        </p>
      </div>
    </div>
  </div>

  <template id="supplementary-person-template">
    <div class="person-container space-y-6 bg-gray-100 p-4 rounded-lg mt-4">
      <button class="w-full text-right text-sm text-red-600 font-semibold remove-supp-btn">Xóa NĐBH này</button>
      <h3 class="text-lg font-bold text-gray-700 mb-2 border-t pt-4" data-template-id="title">NĐBH Bổ Sung</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="font-medium text-gray-700 block mb-1" data-template-id="name-label">Họ và Tên</label>
          <input type="text" class="form-input name-input" placeholder="Trần Thị B" data-template-id="name">
        </div>
          <div>
          <label class="font-medium text-gray-700 block mb-1" data-template-id="dob-label">Ngày sinh</label>
          <input type="text" class="form-input dob-input" placeholder="DD/MM/YYYY" data-template-id="dob">
        </div>
        <div>
          <label class="font-medium text-gray-700 block mb-1" data-template-id="gender-label">Giới tính</label>
          <select class="form-select gender-select" data-template-id="gender">
            <option value="Nam">Nam</option>
            <option value="Nữ">Nữ</option>
          </select>
        </div>
        <div class="flex items-end space-x-4">
          <p class="text-lg">Tuổi: <span class="font-bold text-aia-red age-span" data-template-id="age-span">0</span></p>
        </div>
        <div class="relative">
          <label class="font-medium text-gray-700 block mb-1" data-template-id="occupation-label">Nghề nghiệp</label>
          <input type="text" class="form-input occupation-input" placeholder="Gõ để tìm nghề nghiệp..." data-template-id="occupation-input">
          <div class="occupation-autocomplete absolute z-10 w-full bg-white border border-gray-300 rounded-md mt-1 hidden max-h-60 overflow-y-auto"></div>
        </div>
        <div class="flex items-end space-x-4">
          <p class="text-lg">Nhóm nghề: <span class="font-bold text-aia-red risk-group-span" data-template-id="risk-group-span">...</span></p>
        </div>
      </div>
      <div class="mt-4">
        <h4 class="text-md font-semibold text-gray-800 mb-2">Sản phẩm bổ sung cho người này</h4>
        <div class="supplementary-products-container space-y-6"></div>
      </div>
    </div>
  </template>
  <script>
    window.addEventListener('error', e => {
      const box = document.getElementById('error-message') || document.body.appendChild(Object.assign(document.createElement('div'), {id:'error-message'}));
      box.style.cssText = 'position:fixed;left:8px;bottom:8px;background:#fee;color:#b00;padding:8px 12px;border:1px solid #f99;border-radius:6px;z-index:99999';
      box.textContent = (e.message||'JS error') + ' @ ' + (e.filename||'') + ':' + (e.lineno||'');
    });
  </script>
  <script type="module" src="logic.js"></script>

<!-- LIGHTBOX CHO GALLERY (CHỈ DÁN 1 LẦN) -->
<div id="img-lightbox" style="display:none;">
  <div class="img-lightbox-backdrop" style="position:fixed;inset:0;background:rgba(0,0,0,.6);"></div>
  <div style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none;">
    <div style="background:#fff;max-width:90vw;max-height:90vh;padding:12px;border-radius:6px;box-shadow:0 4px 18px rgba(0,0,0,.3);display:flex;flex-direction:column;gap:8px;pointer-events:auto;">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <strong style="font-size:14px;">Xem ảnh</strong>
        <button class="img-lightbox-close" style="background:#e11;color:#fff;border:none;padding:4px 10px;border-radius:4px;cursor:pointer;">Đóng</button>
      </div>
      <div style="text-align:center;">
        <img id="img-lightbox-main" src="" alt="" style="max-width:80vw;max-height:60vh;object-fit:contain;">
      </div>
      <div id="img-lightbox-caption" style="font-size:12px;color:#555;text-align:center;"></div>
      <div style="display:flex;justify-content:center;gap:8px;">
        <button id="img-lightbox-prev" style="padding:4px 10px;border:1px solid #ccc;border-radius:4px;cursor:pointer;">◀</button>
        <button id="img-lightbox-next" style="padding:4px 10px;border:1px solid #ccc;border-radius:4px;cursor:pointer;">▶</button>
      </div>
    </div>
  </div>
</div>  
</body>
</html>
